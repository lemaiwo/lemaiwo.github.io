"use strict";sap.ui.define(["../Dialog.controller","sap/ui/model/json/JSONModel","sap/ui/model/SimpleType","sap/ui/model/ValidateException","sap/ui/core/library","sap/m/MessageBox"],function(e,t,a,o,r,u){"use strict";function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function F(e,t){try{var a=e()}catch(e){return t(e)}if(a&&a.then){return a.then(void 0,t)}return a}var n=i(e);var l=r["ValueState"];var s=n.extend("be.wl.lemtech.wouter.controller.dialog.Book",{constructor:function e(){n.prototype.constructor.apply(this,arguments);this.customEMailType=a.extend("email",{formatValue:function e(t){return t},parseValue:function e(t){return t},validateValue:function e(t){var a=/(?!.*\.{2})^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;if(!t.match(a)){throw new o("'"+t+"' is not a valid e-mail address")}}})},onBeforeShow:function e(a,o,r,u){var i=this;this.dialog=o;this.viewController=a;this.data=u;this.resolve=r;this.dialog.fragment.setModel(new t({topic:this.data.topic||"btp",mailValidation:"None",mailValidationMessage:"",busy:false,captcha:""}),"book");this.dialog.fragment.attachAfterOpen(function(e){var t;var a=(t=i.fragmentById(i.viewController,"Book","captcha"))===null||t===void 0||(t=t.getDomRef())===null||t===void 0?void 0:t.id;grecaptcha.ready(function(){grecaptcha.render(a,{sitekey:"6LeAvFwpAAAAAMJF8iVpE63VLxE5sPqxv045k169",callback:function e(t){return i.verifyCallback(t)}})})});gtag("event","page_view",{page_title:"bookme-"+this.data.topic,page_location:location.href})},verifyCallback:function e(t){var a=this.dialog.fragment.getModel("book");a.setProperty("/captcha",t)},onBook:function e(){try{var t;var a=function e(){r.setProperty("/busy",false)};var o=this;var r=o.dialog.fragment.getModel("book");if(o.validateInput(o.fragmentById(o.viewController,"Book","mail"))){return Promise.resolve()}r.setProperty("/busy",true);var i=(t=o.viewController.getView())===null||t===void 0||(t=t.getModel())===null||t===void 0?void 0:t.bindContext("/sendMail(...)");i.setParameter("mailFrom",r.getProperty("/mail"));i.setParameter("topic",r.getProperty("/topic"));i.setParameter("description",r.getProperty("/description")||"");i.setParameter("captcha",r.getProperty("/captcha")||"");var n=F(function(){return Promise.resolve(i.execute()).then(function(){u.success("Thank you for your intrest, I'll reach out to you as soon as possible!",{title:"Thank you!"}),o.onClose()})},function(e){if(e.message.indexOf("mail")>-1){r.setProperty("/mailValidation","Error");r.setProperty("/mailValidationMessage",e.message)}else{u.error(e.message,{title:"Error"})}});return Promise.resolve(n&&n.then?n.then(a):a(n))}catch(e){return Promise.reject(e)}},onClose:function e(t){this.dialog.fragment.close();gtag("event","page_view",{page_title:this.data.topic,page_location:location.href});this.resolve(true)},validateInput:function e(t){var a=l.None;var o=false;var r=t.getBinding("value");try{(r===null||r===void 0?void 0:r.getType()).validateValue(t.getValue())}catch(e){a=l.Error;o=true}t.setValueState(a);return o}});return s});
//# sourceMappingURL=Book.controller.js.map