{"version":3,"file":"Book-dbg.controller.js","names":["_catch","body","recover","result","e","then","DialogController","_interopRequireDefault","__DialogController","ValueState","sap_ui_core_library","Book","extend","constructor","prototype","apply","arguments","customEMailType","SimpleType","formatValue","oValue","parseValue","validateValue","rexMail","match","ValidateException","onBeforeShow","_onBeforeShow","viewController","dialog","resolve","data","_this","fragment","setModel","JSONModel","topic","mailValidation","mailValidationMessage","busy","captcha","attachAfterOpen","event","_this$fragmentById","id","fragmentById","getDomRef","grecaptcha","ready","render","callback","response","verifyCallback","gtag","page_title","page_location","location","href","_verifyCallback","bookModel","getModel","setProperty","onBook","_onBook","_this2$viewController","_temp2","_this2","validateInput","Promise","mailCtx","getView","bindContext","setParameter","getProperty","_temp","execute","MessageBox","success","title","onClose","error","message","indexOf","reject","_onClose","close","_validateInput","input","valueState","None","validationError","binding","getBinding","getType","getValue","exception","Error","setValueState"],"sources":["Book.controller.ts"],"sourcesContent":["import DialogController from \"../Dialog.controller\";\r\nimport { frag } from \"../Base.controller\";\r\nimport Popover from \"sap/m/Popover\";\r\nimport UI5Event from \"sap/ui/base/Event\";\r\nimport Dialog from \"sap/m/Dialog\";\r\nimport AppController from \"../App.controller\";\r\nimport Text from \"sap/m/Text\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\r\nimport MessageToast from \"sap/m/MessageToast\";\r\nimport SimpleType from \"sap/ui/model/SimpleType\";\r\nimport ValidateException from \"sap/ui/model/ValidateException\";\r\nimport Input from \"sap/m/Input\";\r\nimport PropertyBinding from \"sap/ui/model/PropertyBinding\";\r\nimport JSONPropertyBinding from \"sap/ui/model/json/JSONPropertyBinding\";\r\nimport { ValueState } from \"sap/ui/core/library\";\r\nimport Value from \"sap/makit/Value\";\r\nimport MessageBox from \"sap/m/MessageBox\";\r\nimport Icon from \"sap/ui/core/Icon\";\r\nimport FlexBox from \"sap/m/FlexBox\";\r\ntype data = {\r\n\ttopic: string;\r\n};\r\ntype notificationEntity = {\r\n\tID: string;\r\n\tfromMail: string;\r\n\tsubject: string;\r\n\tbody: string;\r\n}\r\n/**\r\n * @namespace be.wl.lemtech.wouter.controller.dialog\r\n */\r\nexport default class Book extends DialogController {\r\n\tprivate data: data;\r\n\tprivate resolve: (value: unknown) => void;\r\n\tpublic onBeforeShow(viewController: AppController, dialog: frag, resolve: (value: unknown) => void, data: data): void {\r\n\t\tthis.dialog = dialog;\r\n\t\tthis.viewController = viewController;\r\n\t\tthis.data = data;\r\n\t\tthis.resolve = resolve;\r\n\t\tthis.dialog.fragment.setModel(new JSONModel({ topic: this.data.topic || \"btp\", mailValidation: \"None\", mailValidationMessage: \"\", busy: false ,captcha:\"\"}), \"book\");\r\n\t\t(this.dialog.fragment as Dialog).attachAfterOpen((event: UI5Event) => {\r\n\t\t\tconst id = (this.fragmentById(this.viewController, \"Book\", \"captcha\") as FlexBox)?.getDomRef()?.id;\r\n\t\t\tgrecaptcha.ready(() => {\r\n\t\t\t\tgrecaptcha.render(id, {\r\n\t\t\t\t\t'sitekey': '6LeAvFwpAAAAAMJF8iVpE63VLxE5sPqxv045k169',\r\n\t\t\t\t\t'callback': (response: string) => this.verifyCallback(response)\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\tgtag('event', \"page_view\", {\r\n            page_title: \"bookme-\"+this.data.topic,\r\n            page_location: location.href  // Full URL is required.\r\n        });\r\n\t}\r\n\r\n\tpublic verifyCallback(response: string) {\r\n\t\tconst bookModel = this.dialog.fragment.getModel(\"book\")! as JSONModel;\r\n\t\tbookModel.setProperty(\"/captcha\", response);\r\n\t}\r\n\tpublic async onBook() {\r\n\t\tconst bookModel = this.dialog.fragment.getModel(\"book\")! as JSONModel;\r\n\r\n\t\tif (this.validateInput(this.fragmentById(this.viewController, \"Book\", \"mail\") as Input)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tbookModel.setProperty(\"/busy\", true);\r\n\r\n\t\tconst mailCtx = (this.viewController.getView()?.getModel() as ODataModel)?.bindContext(\"/sendMail(...)\");\r\n\t\tmailCtx.setParameter(\"mailFrom\", bookModel.getProperty(\"/mail\"));\r\n\t\tmailCtx.setParameter(\"topic\", bookModel.getProperty(\"/topic\"));\r\n\t\tmailCtx.setParameter(\"description\", bookModel.getProperty(\"/description\") || \"\");\r\n\t\tmailCtx.setParameter(\"captcha\", bookModel.getProperty(\"/captcha\") || \"\");\r\n\t\ttry {\r\n\t\t\tawait mailCtx.execute();\r\n\t\t\tMessageBox.success(\"Thank you for your intrest, I'll reach out to you as soon as possible!\", { title: \"Thank you!\" }),\r\n\t\t\t\tthis.onClose();\r\n\t\t} catch (error) {\r\n\t\t\tif ((error as { message: string }).message.indexOf(\"mail\") > -1) {\r\n\t\t\t\tbookModel.setProperty(\"/mailValidation\", \"Error\");\r\n\t\t\t\tbookModel.setProperty(\"/mailValidationMessage\", (error as { message: string }).message);\r\n\t\t\t} else {\r\n\t\t\t\tMessageBox.error((error as { message: string }).message, { title: \"Error\" })\r\n\t\t\t}\r\n\t\t\tconsole.error(error);\r\n\t\t}\r\n\t\tbookModel.setProperty(\"/busy\", false);\r\n\t}\r\n\tpublic onClose(event?: UI5Event): void {\r\n\t\t(this.dialog.fragment as Dialog).close(); //eslint-disable-line\r\n\t\t\r\n\t\tgtag('event', \"page_view\", {\r\n            page_title: this.data.topic,\r\n            page_location: location.href  // Full URL is required.\r\n        });\r\n\t\tthis.resolve(true);\r\n\t}\r\n\tprivate validateInput(input: Input) {\r\n\t\tlet valueState: ValueState = ValueState.None;\r\n\t\tlet validationError = false;\r\n\t\tconst binding = input.getBinding(\"value\") as JSONPropertyBinding;\r\n\r\n\t\ttry {\r\n\t\t\t(binding?.getType() as SimpleType).validateValue(input.getValue());\r\n\t\t} catch (exception) {\r\n\t\t\tvalueState = ValueState.Error;\r\n\t\t\tvalidationError = true;\r\n\t\t}\r\n\r\n\t\tinput.setValueState(valueState);\r\n\r\n\t\treturn validationError;\r\n\t}\r\n\tprivate customEMailType = SimpleType.extend(\"email\", {\r\n\t\tformatValue: function (oValue) {\r\n\t\t\treturn oValue;\r\n\t\t},\r\n\r\n\t\tparseValue: function (oValue) {\r\n\t\t\t//parsing step takes place before validating step, value could be altered here\r\n\t\t\treturn oValue;\r\n\t\t},\r\n\r\n\t\tvalidateValue: function (oValue) {\r\n\t\t\t// The following Regex is only used for demonstration purposes and does not cover all variations of email addresses.\r\n\t\t\t// It's always better to validate an address by simply sending an e-mail to it.\r\n\t\t\t// var rexMail = /^\\w+[\\w-+\\.]*\\@\\w+([-\\.]\\w+)*\\.[a-zA-Z]{2,}$/;\r\n\t\t\tconst rexMail = /(?!.*\\.{2})^([a-z\\d!#$%&'*+\\-\\/=?^_`{|}~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+(\\.[a-z\\d!#$%&'*+\\-\\/=?^_`{|}~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+)*|\"((([ \\t]*\\r\\n)?[ \\t]+)?([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f\\x21\\x23-\\x5b\\x5d-\\x7e\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))*(([ \\t]*\\r\\n)?[ \\t]+)?\")@(([a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|[a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF][a-z\\d\\-._~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]*[a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])\\.)+([a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|[a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF][a-z\\d\\-._~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]*[a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])\\.?$/i;\r\n\t\t\tif (!oValue.match(rexMail)) {\r\n\t\t\t\tthrow new ValidateException(\"'\" + oValue + \"' is not a valid e-mail address\");\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}"],"mappings":"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"}