{"version":3,"file":"Book.controller.js","names":["_catch","body","recover","result","e","then","DialogController","_interopRequireDefault","__DialogController","ValueState","sap_ui_core_library","Book","extend","constructor","prototype","apply","this","arguments","customEMailType","SimpleType","formatValue","oValue","parseValue","validateValue","rexMail","match","ValidateException","onBeforeShow","_onBeforeShow","viewController","dialog","resolve","data","_this","fragment","setModel","JSONModel","topic","mailValidation","mailValidationMessage","busy","captcha","attachAfterOpen","event","_this$fragmentById","id","fragmentById","getDomRef","grecaptcha","ready","render","sitekey","callback","response","verifyCallback","gtag","page_title","page_location","location","href","_verifyCallback","bookModel","getModel","setProperty","onBook","_onBook","_this2$viewController","_temp2","_this2","validateInput","Promise","mailCtx","getView","bindContext","setParameter","getProperty","_temp","execute","MessageBox","success","title","onClose","error","message","indexOf","reject","_onClose","close","_validateInput","input","valueState","None","validationError","binding","getBinding","getType","getValue","exception","Error","setValueState"],"sources":["Book.controller.ts"],"sourcesContent":["import DialogController from \"../Dialog.controller\";\r\nimport { frag } from \"../Base.controller\";\r\nimport Popover from \"sap/m/Popover\";\r\nimport UI5Event from \"sap/ui/base/Event\";\r\nimport Dialog from \"sap/m/Dialog\";\r\nimport AppController from \"../App.controller\";\r\nimport Text from \"sap/m/Text\";\r\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\r\nimport ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\r\nimport MessageToast from \"sap/m/MessageToast\";\r\nimport SimpleType from \"sap/ui/model/SimpleType\";\r\nimport ValidateException from \"sap/ui/model/ValidateException\";\r\nimport Input from \"sap/m/Input\";\r\nimport PropertyBinding from \"sap/ui/model/PropertyBinding\";\r\nimport JSONPropertyBinding from \"sap/ui/model/json/JSONPropertyBinding\";\r\nimport { ValueState } from \"sap/ui/core/library\";\r\nimport Value from \"sap/makit/Value\";\r\nimport MessageBox from \"sap/m/MessageBox\";\r\nimport Icon from \"sap/ui/core/Icon\";\r\nimport FlexBox from \"sap/m/FlexBox\";\r\ntype data = {\r\n\ttopic: string;\r\n};\r\ntype notificationEntity = {\r\n\tID: string;\r\n\tfromMail: string;\r\n\tsubject: string;\r\n\tbody: string;\r\n}\r\n/**\r\n * @namespace be.wl.lemtech.wouter.controller.dialog\r\n */\r\nexport default class Book extends DialogController {\r\n\tprivate data: data;\r\n\tprivate resolve: (value: unknown) => void;\r\n\tpublic onBeforeShow(viewController: AppController, dialog: frag, resolve: (value: unknown) => void, data: data): void {\r\n\t\tthis.dialog = dialog;\r\n\t\tthis.viewController = viewController;\r\n\t\tthis.data = data;\r\n\t\tthis.resolve = resolve;\r\n\t\tthis.dialog.fragment.setModel(new JSONModel({ topic: this.data.topic || \"btp\", mailValidation: \"None\", mailValidationMessage: \"\", busy: false ,captcha:\"\"}), \"book\");\r\n\t\t(this.dialog.fragment as Dialog).attachAfterOpen((event: UI5Event) => {\r\n\t\t\tconst id = (this.fragmentById(this.viewController, \"Book\", \"captcha\") as FlexBox)?.getDomRef()?.id;\r\n\t\t\tgrecaptcha.ready(() => {\r\n\t\t\t\tgrecaptcha.render(id, {\r\n\t\t\t\t\t'sitekey': '6LeAvFwpAAAAAMJF8iVpE63VLxE5sPqxv045k169',\r\n\t\t\t\t\t'callback': (response: string) => this.verifyCallback(response)\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\tgtag('event', \"page_view\", {\r\n            page_title: \"bookme-\"+this.data.topic,\r\n            page_location: location.href  // Full URL is required.\r\n        });\r\n\t}\r\n\r\n\tpublic verifyCallback(response: string) {\r\n\t\tconst bookModel = this.dialog.fragment.getModel(\"book\")! as JSONModel;\r\n\t\tbookModel.setProperty(\"/captcha\", response);\r\n\t}\r\n\tpublic async onBook() {\r\n\t\tconst bookModel = this.dialog.fragment.getModel(\"book\")! as JSONModel;\r\n\r\n\t\tif (this.validateInput(this.fragmentById(this.viewController, \"Book\", \"mail\") as Input)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tbookModel.setProperty(\"/busy\", true);\r\n\r\n\t\tconst mailCtx = (this.viewController.getView()?.getModel() as ODataModel)?.bindContext(\"/sendMail(...)\");\r\n\t\tmailCtx.setParameter(\"mailFrom\", bookModel.getProperty(\"/mail\"));\r\n\t\tmailCtx.setParameter(\"topic\", bookModel.getProperty(\"/topic\"));\r\n\t\tmailCtx.setParameter(\"description\", bookModel.getProperty(\"/description\") || \"\");\r\n\t\tmailCtx.setParameter(\"captcha\", bookModel.getProperty(\"/captcha\") || \"\");\r\n\t\ttry {\r\n\t\t\tawait mailCtx.execute();\r\n\t\t\tMessageBox.success(\"Thank you for your intrest, I'll reach out to you as soon as possible!\", { title: \"Thank you!\" }),\r\n\t\t\t\tthis.onClose();\r\n\t\t} catch (error) {\r\n\t\t\tif ((error as { message: string }).message.indexOf(\"mail\") > -1) {\r\n\t\t\t\tbookModel.setProperty(\"/mailValidation\", \"Error\");\r\n\t\t\t\tbookModel.setProperty(\"/mailValidationMessage\", (error as { message: string }).message);\r\n\t\t\t} else {\r\n\t\t\t\tMessageBox.error((error as { message: string }).message, { title: \"Error\" })\r\n\t\t\t}\r\n\t\t\tconsole.error(error);\r\n\t\t}\r\n\t\tbookModel.setProperty(\"/busy\", false);\r\n\t}\r\n\tpublic onClose(event?: UI5Event): void {\r\n\t\t(this.dialog.fragment as Dialog).close(); //eslint-disable-line\r\n\t\t\r\n\t\tgtag('event', \"page_view\", {\r\n            page_title: this.data.topic,\r\n            page_location: location.href  // Full URL is required.\r\n        });\r\n\t\tthis.resolve(true);\r\n\t}\r\n\tprivate validateInput(input: Input) {\r\n\t\tlet valueState: ValueState = ValueState.None;\r\n\t\tlet validationError = false;\r\n\t\tconst binding = input.getBinding(\"value\") as JSONPropertyBinding;\r\n\r\n\t\ttry {\r\n\t\t\t(binding?.getType() as SimpleType).validateValue(input.getValue());\r\n\t\t} catch (exception) {\r\n\t\t\tvalueState = ValueState.Error;\r\n\t\t\tvalidationError = true;\r\n\t\t}\r\n\r\n\t\tinput.setValueState(valueState);\r\n\r\n\t\treturn validationError;\r\n\t}\r\n\tprivate customEMailType = SimpleType.extend(\"email\", {\r\n\t\tformatValue: function (oValue) {\r\n\t\t\treturn oValue;\r\n\t\t},\r\n\r\n\t\tparseValue: function (oValue) {\r\n\t\t\t//parsing step takes place before validating step, value could be altered here\r\n\t\t\treturn oValue;\r\n\t\t},\r\n\r\n\t\tvalidateValue: function (oValue) {\r\n\t\t\t// The following Regex is only used for demonstration purposes and does not cover all variations of email addresses.\r\n\t\t\t// It's always better to validate an address by simply sending an e-mail to it.\r\n\t\t\t// var rexMail = /^\\w+[\\w-+\\.]*\\@\\w+([-\\.]\\w+)*\\.[a-zA-Z]{2,}$/;\r\n\t\t\tconst rexMail = /(?!.*\\.{2})^([a-z\\d!#$%&'*+\\-\\/=?^_`{|}~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+(\\.[a-z\\d!#$%&'*+\\-\\/=?^_`{|}~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]+)*|\"((([ \\t]*\\r\\n)?[ \\t]+)?([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f\\x21\\x23-\\x5b\\x5d-\\x7e\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))*(([ \\t]*\\r\\n)?[ \\t]+)?\")@(([a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|[a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF][a-z\\d\\-._~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]*[a-z\\d\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])\\.)+([a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]|[a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF][a-z\\d\\-._~\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]*[a-z\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])\\.?$/i;\r\n\t\t\tif (!oValue.match(rexMail)) {\r\n\t\t\t\tthrow new ValidateException(\"'\" + oValue + \"' is not a valid e-mail address\");\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}"],"mappings":"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"}