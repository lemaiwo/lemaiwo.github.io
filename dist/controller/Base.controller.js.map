{"version":3,"file":"Base.controller.js","names":["_catch","body","recover","result","e","then","_fragments","Base","Controller","extend","getMainView","_getMainView","this","getView","viewController","onExit","_onExit","onBook","_onBook","topic","_this","Promise","resolve","openFragment","name","data","_this$openFragment","closeResult","reject","_openFragment","config","_temp4","closedPromise","id","controller","_this2","onBeforeShow","popoverSource","fragment","openBy","open","viewName","indexOf","split","substr","lastIndexOf","getViewName","pop","viewPath","join","controllerPath","replace","getId","_temp3","_temp2","Fragment","load","newController","_Fragment$load","newFragment","addDependent","_temp","create","_Controller$create"],"sources":["Base.controller.ts"],"sourcesContent":["import Dialog from \"sap/m/Dialog\";\nimport Popover from \"sap/m/Popover\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport View from \"sap/ui/core/mvc/View\";\nimport DialogController from \"./Dialog.controller\";\n\nexport type frag = {\n\tcontroller: DialogController;\n\tfragment: Fragment;\n};\ntype frags = Record<string, frag>;\nlet _fragments: frags = {};\n/**\n * @namespace be.wl.lemtech.wouter.controller\n */\nexport default class Base extends Controller {\n\tprotected viewController: Controller;\n\n\tpublic getMainView() {\n\t\treturn this.getView() || this.viewController.getView();\n\t}\n\tpublic onExit(): void {\n\t\t_fragments = {};\n\t}\n\tpublic async onBook(topic: string) {\n\t\tconst closeResult = (await this.openFragment({\n\t\t\tname: \"be.wl.lemtech.wouter.view.dialog.Book\",\n\t\t\tdata: { topic: topic || \"\" }\n\t\t})) as string;\n\t}\n\n\tpublic async openFragment(config: { name: string; data?: unknown; popoverSource?: Popover }): Promise<unknown> {\n\t\tlet viewName: string[];\n\t\tif (config.name.indexOf(\".\") > 0) {\n\t\t\t//full path\n\t\t\tviewName = config.name.split(\".\");\n\t\t\tconfig.name = config.name.substr(config.name.lastIndexOf(\".\") + 1);\n\t\t} else {\n\t\t\t//current folder\n\t\t\tviewName = this.getMainView()!.getViewName().split(\".\");\n\t\t}\n\t\tviewName.pop();\n\t\tconst viewPath = viewName.join(\".\") + \".\",\n\t\t\tcontrollerPath = viewPath.replace(\"view\", \"controller\"),\n\t\t\tid = this.getMainView()!.getId() + \"--\" + config.name;\n\t\tif (!_fragments[id]) {\n\t\t\tlet newController: Controller;\n\t\t\ttry {\n\t\t\t\tnewController = (await Controller.create({\n\t\t\t\t\tname: controllerPath + config.name\n\t\t\t\t})) as Controller;\n\t\t\t} catch (error) {\n\t\t\t\t// console.log(\"Dialog without controller. Just continue with the current controller for the dialog\");\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tnewController = this;\n\t\t\t}\n\t\t\tconst newFragment = (await Fragment.load({\n\t\t\t\tid: id,\n\t\t\t\tname: viewPath + config.name,\n\t\t\t\tcontroller: newController\n\t\t\t})) as unknown as Fragment;\n\t\t\t_fragments[id] = { controller: newController as DialogController, fragment: newFragment };\n\t\t\tthis.getMainView()!.addDependent(_fragments[id].fragment as unknown as UI5Element);\n\t\t}\n\t\tconst closedPromise = new Promise((resolve, reject) => {\n\t\t\tif (_fragments[id].controller && (_fragments[id].controller as Controller) !== this) {\n\t\t\t\tif (\"onBeforeShow\" in _fragments[id].controller) {\n\t\t\t\t\t_fragments[id].controller.onBeforeShow(this, _fragments[id], resolve, config.data, config.popoverSource);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (config.popoverSource) {\n\t\t\t(_fragments[id].fragment as unknown as Popover).openBy(config.popoverSource, false);\n\t\t} else {\n\t\t\t(_fragments[id].fragment as Dialog).open();\n\t\t}\n\t\treturn closedPromise; //_fragments[id].fragment;\n\t}\n}"],"mappings":"4GAkjBO,SAAAA,EAAgBC,EAAMC,GAC5B,IACC,IAAIC,EAASF,GACd,CAAE,MAAMG,GACP,OAAOF,EAAQE,EAChB,CACA,GAAID,GAAUA,EAAOE,KAAM,CAC1B,OAAOF,EAAOE,UAAU,EAAGH,EAC5B,CACA,OAAOC,CACR,CA/iBA,IAAIG,EAAoB,CAAC,EACzB,IAGqBC,EAAaC,EAAUC,OAAA,wCAGpCC,YAAW,SAAAC,IACjB,OAAOC,KAAKC,WAAaD,KAAKE,eAAeD,SAC9C,EACOE,OAAM,SAAAC,IACZV,EAAa,CAAC,CACf,EACaW,OAAM,SAAAC,EAACC,GAAa,IAAE,IAAAC,EACPR,KAAI,OAAAS,QAAAC,QAAJF,EAAKG,aAAa,CAC5CC,KAAM,wCACNC,KAAM,CAAEN,MAAOA,GAAS,OACvBd,KAAA,SAAAqB,GAHF,IAAMC,EAAWD,CAGH,EACf,CAAC,MAAAtB,GAAA,OAAAiB,QAAAO,OAAAxB,EAAA,GAEYmB,aAAY,SAAAM,EAACC,GAAiE,IAAoB,IAAAC,EAAA,SAAAA,IAiC9G,IAAMC,EAAgB,IAAIX,QAAQ,SAACC,EAASM,GAC3C,GAAItB,EAAW2B,GAAIC,YAAe5B,EAAW2B,GAAIC,aAAUC,EAA0B,CACpF,GAAI,iBAAkB7B,EAAW2B,GAAIC,WAAY,CAChD5B,EAAW2B,GAAIC,WAAWE,aAAYD,EAAO7B,EAAW2B,GAAKX,EAASQ,EAAOL,KAAMK,EAAOO,cAC3F,CACD,CACD,GACA,GAAIP,EAAOO,cAAe,CACxB/B,EAAW2B,GAAIK,SAAgCC,OAAOT,EAAOO,cAAe,MAC9E,KAAO,CACL/B,EAAW2B,GAAIK,SAAoBE,MACrC,CACA,OAAOR,CAAe,MAAAG,EArCVvB,KAPZ,IAAI6B,EACJ,GAAIX,EAAON,KAAKkB,QAAQ,KAAO,EAAG,CAEjCD,EAAWX,EAAON,KAAKmB,MAAM,KAC7Bb,EAAON,KAAOM,EAAON,KAAKoB,OAAOd,EAAON,KAAKqB,YAAY,KAAO,EACjE,KAAO,CAENJ,EAAWN,EAAKzB,cAAeoC,cAAcH,MAAM,IACpD,CACAF,EAASM,MACT,IAAMC,EAAWP,EAASQ,KAAK,KAAO,IACrCC,EAAiBF,EAASG,QAAQ,OAAQ,cAC1ClB,EAAKE,EAAKzB,cAAe0C,QAAU,KAAOtB,EAAON,KAAK,IAAA6B,EAAA,eAClD/C,EAAW2B,GAAG,KAAAqB,EAAA,SAAAA,IAAA,OAAAjC,QAAAC,QAWSiC,EAASC,KAAK,CACxCvB,GAAIA,EACJT,KAAMwB,EAAWlB,EAAON,KACxBU,WAAYuB,KACXpD,KAAA,SAAAqD,GAJF,IAAMC,EAAWD,EAKjBpD,EAAW2B,GAAM,CAAEC,WAAYuB,EAAmCnB,SAAUqB,GAC5ExB,EAAKzB,cAAekD,aAAatD,EAAW2B,GAAIK,SAAmC,IAhBnF,IAAImB,EAA0B,IAAAI,EAAA7D,EAAA,WAC1B,OAAAqB,QAAAC,QACoBd,EAAWsD,OAAO,CACxCtC,KAAM0B,EAAiBpB,EAAON,QAC7BnB,KAAA,SAAA0D,GAFFN,EAAaM,CAEK,EACnB,EAAC,WAGAN,EAAatB,CACd,GAAC,OAAA0B,KAAAxD,KAAAwD,EAAAxD,KAAAiD,KAAAO,EAAA,EAXqD,GAWrD,OAAAxC,QAAAC,QAAA+B,KAAAhD,KAAAgD,EAAAhD,KAAA0B,KAAAsB,GAsBH,CAAC,MAAAjD,GAAA,OAAAiB,QAAAO,OAAAxB,EAAA,YA9DmBG,CAAI","ignoreList":[]}